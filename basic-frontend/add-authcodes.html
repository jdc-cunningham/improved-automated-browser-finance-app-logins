<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add auth codes</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="app">
    <h1>Add auth code</h1>
    <p id="prefix-list">Fetching existing accounts...</p>
    <div class="row">
      <input id="account-prefix"  type="text" name="prefix" placeholder="ex. bofa"/>
      <input id="auth-code" type="number" name="auth code" placeholder="123456"/>
      <button id="add-auth-code" type="button">Add</button>
    </div>
  </div>
  <script>
    const localApiUrl = 'http://localhost:5042/add-auth-code';

    // from MDN
    function postAjax(url, data, success) {
      var params = typeof data == 'string' ? data : Object.keys(data).map(
              function(k){ return encodeURIComponent(k) + '=' + encodeURIComponent(data[k]) }
          ).join('&');

      var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
      xhr.open('POST', url);
      xhr.onreadystatechange = function() {
          if (xhr.readyState>3 && xhr.status==200) { success(xhr.responseText); }
      };
      xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      xhr.send(params);
      return xhr;
    }

    function getAjax(url, success) {
        var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');
        xhr.open('GET', url);
        xhr.onreadystatechange = function() {
            if (xhr.readyState>3 && xhr.status==200) success(xhr.responseText);
        };
        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
        xhr.send();
        return xhr;
    }

    getAjax('http://localhost:5042/get-account-prefixes', res => {
      const data = JSON.parse(res);

      if (data?.accountPrefixes.length) {
        document.getElementById('prefix-list').innerText = 'Existing accounts:' + '\n\n' + data.accountPrefixes.map(val => val).join('\n');
      }
    });

    const addBtn = document.getElementById('add-auth-code');

    addBtn.addEventListener('click', () => {
      // verify not empty
      const accountInput = document.getElementById('account-prefix');
      const authCodeInput = document.getElementById('auth-code');

      if (!accountInput.value.length || !authCodeInput.value.length) {
        alert('Please make sure both fields are filled in.');
        return;
      }

      postAjax(
        localApiUrl,
        {
          accountPrefix: accountInput.value,
          authCode: authCodeInput.value
        },
        (res) => {
          console.log(res);
        }
      );
    });
  </script>
</body>
</html>